providers = ["python", "node"]

[phases.setup]
nixPkgs = ["python312", "python312Packages.pip"]

[phases.install]
dependsOn = ["setup"]
cmds = [
  "echo '=== Starting build process ==='",
  "pwd",
  "echo 'Step 1: Installing Python dependencies...'",
  "python3 -m pip install --upgrade pip || python3 -m ensurepip --upgrade",
  "python3 -m pip install -r requirements.txt",
  "echo 'Step 2: Installing Node.js dependencies...'",
  "cd frontend && npm install || (echo 'npm install failed' && exit 1)",
  "echo 'Step 3: Building frontend...'",
  "cd frontend && npm run build || (echo 'npm run build failed' && exit 1)",
  "echo 'Step 4: Verifying build output...'",
  "cd ..",
  "ls -la app/static/ || (echo 'ERROR: app/static/ not found!' && ls -la app/ && exit 1)",
  "echo '=== Build complete ==='"
]

[phases.build]
cmds = []

[start]
cmd = "python3 start.py"
